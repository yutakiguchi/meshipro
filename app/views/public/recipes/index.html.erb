<div class="container">
  <h1>RECIPE</h1>
 <div class="card ranking row pl-5 pt-2 pb-2">
 <h4 class="ranking row mb-4">人気順</h4>
 <div class="rank-box row mx-auto">
  <% @ranks.each.with_index(1) do |recipe, i| %>
   <h6><%= i %>位</h6>
   <div class="card mx-5">
    <%= link_to public_recipe_path(recipe.id) do %>
     <%= attachment_image_tag recipe.recipe_images[0], :image,:fill,180,180 %>
    <% end %>
     <div class="average-review-rating-index mt-2" data-score=<%= recipe.recipe_comments.average(:rating)&.round(2) %>></div>
     <%= link_to public_recipe_path(recipe.id) do %>
      <h5 class="text-success mt-3"><%= recipe.name %></h5>
      <% end %>
      <i class="fas fa-thumbs-up" style="color: royalblue;"><%= recipe.my_recipes.count %></i>



   </div>
  <% end %>
  </div>
  </div>



   <div class="row mt-4">
    <h5>全<span class="font-weit-nomal small"><%= @search_recipes.count %></span>件</h5>
   </div>


   <% @search_recipes.each do |recipe| %>
     <%= link_to public_recipe_path(recipe.id)do %>
      <div class="recipe-index row m-5 p-3 border-top">
       <div class="col-md-3">
        <%= attachment_image_tag recipe.recipe_images[0], :image,:fill,270,250,format: 'jpeg',fallback: "795px-No_image.jpg",size:'270x250' %>
       </div>
       <div class="col-md-3 mx-3">
        <h4 class="text-success"><%= recipe.name %></h4>
     <% end %>
        <div class="average-review-rating-index mt-2 mb-1" data-score=<%= recipe.recipe_comments.average(:rating)&.round(2) %>></div>
        <div id="favorite_buttons_<%= recipe.id %>">
          <%= render 'public/my_recipes/favorite',recipe: recipe %>
       </div>
        <p class="mt-3"><%= recipe.explanation %></p>
        </div>
        <div class="col-md-3">
         <p class="title-material-mini">【材料】</p>
         <% recipe.materials.each_with_index do |material, i| %>
          <% if material.name.present? %>
           <%= "|"unless i==0 %><%= material.name %>:<%= material.quantity %>
          <% end %>
         <% end %>
        </div>
        </div>
       <% end %>
<script>
 $('.average-review-rating-index').raty({
        readOnly: true,
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        score: function() {
        return $(this).attr('data-score')
        }
      });
</script>

